{
	"name": "FlattenPrevalenceData",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ADLS_DiabetesPrevalence_JSON",
						"type": "DatasetReference"
					},
					"name": "DiabetesPrevalence"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "Parquet1",
						"type": "DatasetReference"
					},
					"name": "SinkToStandardized"
				}
			],
			"transformations": [
				{
					"name": "FlattenJSON"
				},
				{
					"name": "SelectValues"
				},
				{
					"name": "FilterScandinavia"
				}
			],
			"scriptLines": [
				"source(output(",
				"          {@odata.context} as string,",
				"          value as (Id as integer, IndicatorCode as string, SpatialDimType as string, SpatialDim as string, TimeDimType as string, ParentLocationCode as string, ParentLocation as string, Dim1Type as string, Dim1 as string, TimeDim as integer, Dim2Type as string, Dim2 as string, Dim3Type as string, Dim3 as string, DataSourceDimType as string, DataSourceDim as string, Value as string, NumericValue as double, Low as double, High as double, Comments as string, Date as string, TimeDimensionValue as string, TimeDimensionBegin as string, TimeDimensionEnd as string)[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'singleDocument') ~> DiabetesPrevalence",
				"DiabetesPrevalence foldDown(unroll(value),",
				"     mapColumn(",
				"          {@odata.context},",
				"          value",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> FlattenJSON",
				"FilterScandinavia select(mapColumn(",
				"          Gender = value.Dim1,",
				"          CountryCode = value.SpatialDim,",
				"          Year = value.TimeDim,",
				"          AgeGroup = value.Dim2,",
				"          {Prevalence%} = value.NumericValue,",
				"          LowerConfidence = value.Low,",
				"          UpperConfidence = value.High",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectValues",
				"FlattenJSON filter(value.SpatialDim == 'NOR' || value.SpatialDim == 'SWE' ||",
				"value.SpatialDim == 'DNK') ~> FilterScandinavia",
				"SelectValues sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'parquet',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1) ~> SinkToStandardized"
			]
		}
	}
}